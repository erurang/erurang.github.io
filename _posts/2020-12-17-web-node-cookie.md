---
layout: post
title:  "State & Cookie & Session"
subtitle: "State & Cookie & Session"
categories: web
tags: base
comments: true

---
## http state

http는 stateless라서 사용자에 맞는 정보를 저장할수가 없습니다.

**그럼 stateless는 무엇인가?**

사용자(클라이언트)의 상태를 가지지않는 방식입니다.
예를들어 내가 naver.com에 접속을 하여 로그인을 하여도 새로고침이나 다른
naver.com/~~ 링크로 이동을 하여도 다시 로그인을 해야합니다.

즉 상태가 유지가 되지않습니다. 그래서 stateless입니다.

근데 우리는 실생활web에서 이렇다면 진짜 화딱지가 엄청 나겟죠?

그래서 stateful한 시스템을 만들고싶다! 해서 나온것이 바로 쿠키와 세션입니다.

### Cookie & Session

쿠키는 개인화를 도와준다.

여기서 말하는 개인화는 그 사용자에게 맞는 정보를 제공해주는것이라고 할수있다.

[얄팍한코딩사전-유튜브-쿠키와세션](https://www.youtube.com/watch?v=OpoVuwxGRDI)에서 쉽게 알려준다.

쿠키는 누군가 가져가도 큰 무리가없는 개인정보를 사용자에게.
세션은 보안이 중요한것을 서버에 가지고 있는것이다.

**즉 두가지의 차이점은 상태정보를 사용자에게 두느냐 서버에 두느냐 의 차이라고 할수있다.**

쿠키는 브라우저에 보존되고 http 헤더에 저장되는 텍스트 파일입니다.

그래서 쿠키가 얻어지는 과정을 보자면

1. 쿠키가 없는 상태에서 서버에 req 요청을 함.
2. 서버는 req의 헤더에 쿠키가 없는것을 확인후 서버에서 상태유지를 위한 임시 키(세션id)를 클라이언트에게 돌려줌
3. 클라이언트는 받은 쿠키를 보존함
4. 차후 연결에서는 서버가 클라이언트가 가지고있는 쿠키의 세션id를 확인하고 정보를 처리함

즉 쿠키는 데이터가 컴퓨터에 저장이 된다. 그래서 이걸 악용할수도 있다.
즉 세션은 보안에 중요한 자료를 가지고있고 세션에서는 사용자가 로그인(..등)을 하면 임시키(세션id)를 브라우저에 주어 맞는 정보로 응답한다.

## 사용자 인증 예시

나는 mytube 프로젝트를 하면서 공부하게된 것이지 auth에 대한 예시로 이 쿠키와 세션을 다루겠다.

### 사용자가 서버에 사용자의 name과 password를 줄때

```
사용자  ==========> 서버
name              DB..
Password
```
서버는 사용자의 Name과 password가 db에 있는것과 같은지 확인후 사용자에게

id = 12qrqer1234 라는 쿠키를 돌려준다. 그후에

사용자가 어느 웹사이트에 접속을 할때마다(req) 서버는 세션을 찾아서 세션id를 확인후에

timeout을 업데이트해주고 권한도 확인후에 다시 클라이언트에게 맞는 정보를 돌려준다.

그래서 서버내부에 램에 db형식으로 저장을 함.