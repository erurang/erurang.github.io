---
layout: post
title:  "JS엔진의 이해"
subtitle: "JS엔진의 이해"
categories: web
tags: javascript
comments: true

---

자바스크립트 엔진의 구동원리는 무엇일까?

자바스크립트는 싱글 쓰레드 언어일까? 멀티 쓰레드 언어일까?

### - [1] 쓰레드는 무엇인가?

[프로세스구조](https://erurang.github.io/cs/2020/10/12/os-process/) 에 정리해두었다.

간단히 얘기하자면 운영체제에는 메모리 위에서 프로세스가 존재한다.

이 프로세스마다 쓰레드 라는것이 존재하는데

쓰레드는 한 프로세스가 동시에 여러일을 할수있도록 도와준다고 할수있다.

쓰레드를 몇개를 쓸지도 정해서 쓸수있다. 쓰레드의 사용 예로 

db받아오는건 1번 쓰레드 db를 처리하는건 2번 쓰레드로 처리하게 구현할수 있다는것이다.

하지만 자바스크립트는 싱글쓰레드언어이다. 그럼 자바스크립트를 기반으로 돌아가는 웹들은

어떻게 인터넷 서칭을 하면서 다운로드를 받고 음악을 듣고 이게 가능한것일까?

자바스크립트는 쓰레딩을 지원하지않지만 자바스크립트가 돌아가는 브라우저는 멀티쓰레딩을 지원한다.

그래서 우리는 자바스크립트 언어로 Web Api들을 이용하여서 멀티쓰레딩이 가는한것처럼 만들수있다.

### - [2] 자바스크립트 엔진이해하기

자바스크립트 엔진에는 메모리힙과 콜스택으로 나뉘어져있다.

메모리힙에 변수를 선언하거나 값을 할당하는 데이터들이 모두 저장된다.

콜스택에 우리가 데이터를 실행하는 함수들이 스택처럼 쌓이게된다.

예로 이해해보자.

우리 코드가 다음과같이 콜백에 콜백을 부르고 마지막에는 setTimeout을 실행한다고 가정해보자.

<img width="397" alt="스크린샷 2021-02-04 오전 1 22 31" src="https://user-images.githubusercontent.com/56789064/106776498-75ecbf80-6687-11eb-80b4-847616ea71d9.png">


main()을 실행하면 main -> one -> two 로 차례대로 들어간후 two에서 2초뒤 실행되는 setTimeout을 실행하는데

setTimeout은 web Api에서 우리가 지정한 2초뒤에 task Queue 라는곳에 값을 돌려주기로 약속하고, 

자바스크립트는 나머지 실행조건을 먼저 실행해나간다.

이렇게 콜스택과 태스크큐를 관리하는 이벤트루프 라는것이 존재한다.

이 이벤트루프는 첫째로 콜스택을 먼저 처리한다. 콜스택에 처리될 것이 하나도 없을때

이벤트루프는 태스크큐로 넘어가 콜백값들을 콜스택으로 가져온후 자바스크립트가 콜스택을 처리하는 과정이다.

다음시간에는 브라우저가 웹을 전체적으로 구상할때 어떻게 이벤트 루프가 작동하는지 전체적으로 살펴보겠다.

[browser rendering CRP](https://erurang.github.io/web/2020/12/08/js-render/)를 읽고 다음글을 보면 도움이 될것이다.