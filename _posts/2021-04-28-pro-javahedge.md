---
layout: post
title:  "내가 말 햇제!"
subtitle: "내가 말 햇제!"
categories: project
tags: CoinStock
comments: true

---

### 기존 계획안에서 현재까지 진행된 상황과 현재까지의 개발 상황을 글로 적어본다.

Mongodb
  - Mongoose로 회원가입/유저수익률/가입일/닉네임/거래내역 .. 등을 관리하도록 하였습니다.

API
  - 주식 -> Upbit와 binance API을 이용하여 실시간 코인정보를 가져왔습니다
    - 초당 api 요청제한이 있어서 내 로컬서버에 1초마다 setinterval을 통해 실시간 정보를 받은후에 자체 api를 만들어서 요청을 받아 클라이언트에서 처리하게 만들었습니다.

API처리 : restAPI

view
  - javascript (pug) => 매초마다 실시간으로 가져오는 코인의 정보들을 처리하는데 큰 어려움을 겪었습니다. 
  - 코인이 한개 두개.. 하드코딩이 가능한 경우에 innerHTML 또는 Textcontent로 일일이 api를 1초마다 받아와서 실시간처럼 보이게 처리할수있었습니다.
  - 하지만 엄청난 수의 코인들을 모두 하나하나 하드코딩하기엔 너무 답이없는 방법이라고 생각했습니다.
  - 그래서 일단은 실시간 처리처럼 보이게끔처리하기위해서 Table로 구성된 코인표와 실시간 잔고 표를 만들었고 DOM remove를 통하여 tbody를 삭제후 innerHTML으로 다시 생성하는 방식으로 전체가 리셋되는것처럼 보이게 만들어진 상태입니다.
  - 이 방법자체가 잘못된단걸 알고, 구글링한결과. 상태관리 라이브러리엔 Redux가 존재하단걸 알았습니다. redux에 비동기를 사용하기위한 saga/thunk 도 공부해야함을 알았습니다.
  - 현재의 개발상황은 https://github.com/erurang/coinstock 까지입니다.

server : nodejs

일단 리덕스를 제대로 공부해보기전 리액트에선 자체 컴포넌트마다 상태관리가 가능하기떄문에 실시간 값처리가 가능하다고 생각이 들었고, 리액트를 통하여 실시간 코인정보를 처리하는 사이트를 하나 데모로 만들었습니다.

깃허브 소스코드 https://github.com/erurang/btckimp 
배포된 사이트 https://erurang.github.io/btckimp/

현재 블로그 PROJECT란에 KIMP 란에 정리되어있습니다.

====> 현재까지 이 프로젝트를 만들어보면서 느낀것들

view(client)와 server를 분리하고 거기에 알맞은 역할을 분담하는것이 중요하단것을 알았음.

처음 프로젝트를 시작할때는 front에서 pug템플릿마다 script로 연결해 모든 api로직들을 일일이 프론트단 js에서 다 처리하고있었다. 

그리고 왜 프론트단 js에서는 axios나 Import나.. 등등 왜 이문법은 써지지않지? 분명 공부할때는 .js 파일만들고 하면 됬었는데.. 하고 단편적인 생각만 하고있었다. 

하지만 서버에서의 js문법과 front(웹브라우저)에서의 js문법의 차이가 있다는것을 알았고 왜 fetch와 axios가 갈라져있는지, 

왜 Front의 .js파일들과 server의 .js파일들이 다른지, 익스프레스가 왜 브라우저밖에서 사용가능하게한 js인지 알게되었다.

그리고 서버와 클라이언트가 api를 통해 정보를 주고받게 만드는것, CORS를 피하기위한 proxy방법, 내 로컬서버로 API를 만들어서 통신을하게 만드는법, 등등.. 약 한달..?의 시간동안 좀더 큰 그림을 그린거같다.

지금 5월달안의 목표는 이것이다. 일단 취업준비는 기본이고.. 

일단 기존에 만들었던 현재 프로젝트의 랭킹/거래내역.. 등등 시스템을 고칠려한다. 세부 계획은 다음과 같다

1. 한 5초~10초 정도로 업비트의 코인의 등락을 비교하여 갑자기 급등한 종목들을 리스트(테이블)에 나열해주는것이다 (사용자설정 % 추가할예정)
   - 그럼 더더욱 주가의 변동을 눈치채기 편해서 단타하기 편할것..
2. 애초에 계획햇던 투표기능을 활성화하려한다
   1. 매번 9시만되면 어떤종목이 오를까? 어느 커뮤니티를 봐도 친구들을봐도 9시전에 어떤종목올라!! 어떤거사!! 하고 말하는걸 볼수있다. 이건 모든 사람들이 공통적으로 궁금해하는것이 아닐까?
   2. 그래서 9시이전에 매수숫자를 %로 따져서 (이건 일단 만든후에 생각..) %별로 리스트에 실시간 반영하는것이다.
   3. 실시간 반영을 위해선 websocket을 쓰거나, mongo에서 자체적으로 코인 db에 vote수를 기록하여 올리는 방법 2가지가 있을것같다
   4. 예상되는 문제로는 웹소켓을 쓸경우 매 접속자마다 포트를열어 클라이언트마다 연결을해야한다는점 => 여기서 나타날 문제점이 무엇인지 아직 예측하지못하겠다..
   5. mongo를 매번 api를 통해 받을경우도 잦은 api요청이 어떻게 서버에 반영이 될지도 예측하지못했다. 그리고 잦은 Front에서의 dom변경이 어떤일이 일어날지도.. => 이런경우 레디스라는 것이 있다는 조언이 있었는데..

### 그래서 정리하면 추가 삭제될 기능들은 다음과 같다
   
1. 추가될 예정
   1. 투표바
   2. 실시간 채팅창 
   3. 투표된것을 실시간으로 순위매겨줄 테이블
   4. 일정 시간마다 %를 비교해 갑자기 급등한 종목들을 알려줄 테이블
   
2. 삭제될 예정
   1. 유저별 거래내역 / 수익률 랭킹란 / 유저 잔고